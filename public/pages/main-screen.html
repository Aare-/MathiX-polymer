<polymer-element name="main-screen">
  <template>  
    <style>      
      
    </style>

    <core-scaffold >
      <core-header-panel navigation flex name="scaffold">  
        <core-toolbar id="navheader">
          <span>MathiX</span>
        </core-toolbar>    

        <core-menu selected="{{selected_menu}}">    
          <paper-item noink>
            <core-icon icon="dashboard"></core-icon>
            <p>Dashboard</p>
          </paper-item>
          <paper-item noink>
            <core-icon icon="account-circle"></core-icon>
            <p>Moje konto</p>
          </paper-item>                  
        </core-menu>
      </core-header-panel>    
          
      <template id="toolbarTitle" is="auto-binding" bind="{{menuTitle}}">
        <core-toolbar tool>{{menuTitle.value}}</core-toolbar>    
      </template>

      <core-animated-pages id="menu" selected="{{selected_menu}}" on-core-select="{{mainMenuSelectAction}}">    
        <div class="content">
          <paper-tabs selected="{{selected_tab}}" class="bottom fit" on-core-select="{{menuSelectAction}}">     
            <template id="dashboardTabs" repeat="{{tab in dashboardTabs}}">
              <paper-tab>{{tab.title}}</paper-tab>
            </template>
          </paper-tabs>  

          <core-animated-pages id="pages" selected="{{selected_tab}}" transitions="slide-from-right">      
            <div>
              <events-tab myId="0"></events-tab>
            </div>      

            <div>
              <groups-list-tab goToAddGroup="{{goToAddGroup}}" myId="1"></groups-list-tab>              
            </div>          

            <div>                                 
              <excercises-tab goToNewExcercise="{{goToNewExcercise}}" myId="2"></excercises-tab>              
            </div>                  

            <div>
              <new-group-form myId="3"></new-group-form>
            </div>

            <div>
              <new-excercise-form myId="4"></new-excercise-form>
            </div>

            <div>
              <groups-details-page myId="5"></groups-details-page>
            </div>

            <div>
              <excercise-details-page myId="6"></excercise-details-page>
            </div>
          </core-animated-pages>        
        </div> 

        <div class="content">
          <account-details></account-details>
        </div>  
      </core-animated-pages>

    </core-scaffold>  
    <paper-toast id="globalToast" text="{{global_toast_msg}}"></paper-toast>  
  </template>

  <script type="text/javascript">
    var pages = null;
    var menu = null;
    var toolbarTitle = null;
    var dashboardTabs = [
      {title : "wydarzenia"},
      {title : "studenci"},
      {title : "zadania"}
    ];
    var _dashboardPages = [
      {id: 0,
       title: "dashboard"},
      {id: 1,
       title: "dashboard"},
      {id: 2,
       title: "dashboard"},
      {id: 3,
       title: "nowa grupa"},
      {id: 4,
       title: "nowe zadanie"},
      {id: 5,
       title: "grupa, detale"},
      {id: 6,
       title: "zadanie, detale"},
    ];
    var _menuTitles = [
      {getTitle : function() {return _dashboardPages[pages.selected].title;}},
      {getTitle : function() {return "moje konto";}},
    ];    
    var _context;
    var _globalToast;    

    var Utils = (function() {
        return {          
          showToast : function(message) {
            _context.global_toast_msg = message;            
            _globalToast.show();
          }
        };
    }());

    var Navigator = (function() {
      var onSwitchCallbacks = [];

      return {
        switchScreen : function(screenId) {
          pages.selected = screenId;                    
        },

        updateScreen : function() {
          toolbarTitle.menuTitle = {value: _dashboardPages[pages.selected].title};        
          onSwitchCallbacks.forEach(function(val) {
            val(pages.selected);
          });
        },

        registerCallback : function(call) {
          onSwitchCallbacks.push(call);
        }
      };
    }());    

    Polymer("main-screen", {
      ready: function() {      
        this.dashboardTabs = dashboardTabs;

        toolbarTitle = this.$.toolbarTitle;        
        pages = this.$.pages;       
        menu = this.$.menu;   
        _context = this;        
        _globalToast = this.$.globalToast;
      },
      menuSelectAction: function() {        
        Navigator.updateScreen();
      },
      mainMenuSelectAction: function() {
        toolbarTitle.menuTitle 
          = {value: _menuTitles[menu.selected].getTitle()};
      },
      goToAddGroup: function() {        
        Navigator.switchScreen(3);
      },
      goToNewExcercise: function () {
        Navigator.switchScreen(4);
      }
    });
      
  </script>
</polymer-element>